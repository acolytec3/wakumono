(this.webpackJsonpwakumono=this.webpackJsonpwakumono||[]).push([[9],{1065:function(e,t){},1131:function(e,t){},1208:function(e,t,n){"use strict";n.r(t);var a=n(1262),r=n(0),c=n.n(r),s=n(130),o=n.n(s),i=n(265);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var u=n(22);o.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(a.a,{children:Object(u.jsx)(i.b,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},147:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return u}));var a=n(61),r=n(25),c=n(17),s=n(0),o={addressBook:{},reverseAddressBook:{},messageList:[]},i=function(e,t){switch(t.type){case"SET_WEB3":return Object(c.a)(Object(c.a)({},e),{},{web3:t.payload.web3});case"START_WAKU":return Object(c.a)(Object(c.a)({},e),{},{waku:t.payload.waku});case"SET_ADDRESS":return Object(c.a)(Object(c.a)({},e),{},{address:t.payload.address});case"SET_ONBOARD":return Object(c.a)(Object(c.a)({},e),{},{onboard:t.payload.onboard});case"SET_KEYS":return Object(c.a)(Object(c.a)({},e),{},{keys:t.payload.keys});case"ADD_PEER":var n=Object(r.a)({},Object.values(t.payload)[0],Object.keys(t.payload)[0]);return Object(c.a)(Object(c.a)({},e),{},{addressBook:Object(c.a)(Object(c.a)({},e.addressBook),t.payload),reverseAddressBook:Object(c.a)(Object(c.a)({},e.reverseAddressBook),n)});case"ADD_MESSAGE":return Object(c.a)(Object(c.a)({},e),{},{messageList:[].concat(Object(a.a)(e.messageList),[t.payload])});default:return e}},u=n.n(s).a.createContext({state:o,dispatch:function(){return null}})},228:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));var a=n(1),r=n.n(a),c=n(28),s=n(77),o=function(e){return e?e.substring(0,4)+"..."+e.substring(e.length-4):"Unknown Sender"},i=function(){var e=Object(c.a)(r.a.mark((function e(t,n,a){var c,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={message:a,childSig:s.a.sign(t.privateKey,s.a.hash.keccak256(a))},e.next=3,s.a.encryptWithPublicKey(n,JSON.stringify(c));case 3:return o=e.sent,e.abrupt("return",s.a.cipher.stringify(o));case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()},265:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return E}));var a,r=n(25),c=n(1),s=n.n(c),o=n(28),i=n(19),u=n(1215),d=n(1214),l=n(149),p=n(393),b=n(291),f=n(174),j=n(592),h=n(565),v=n(77),O=n(224),y=n(148),x=n(577),k=n(0),w=n.n(k),m=n(578),g=n(581),S=n(147),A=n(22),E="wakumono/dm",B="wakumono/broadcast";t.b=function(){var t=w.a.useReducer(S.c,S.b),n=Object(i.a)(t,2),c=n[0],k=n[1],C=Object(u.a)(),D=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.payload||!c.keys||c.reverseAddressBook==={}){e.next=14;break}return e.prev=1,e.next=4,v.a.decryptWithPrivateKey(c.keys.privateKey,v.a.cipher.parse(t.payloadAsUtf8));case 4:n=e.sent,a=JSON.parse(n),r=v.a.recoverPublicKey(a.childSig,v.a.hash.keccak256(a.message)),k({type:"ADD_MESSAGE",payload:{from:null!==r&&void 0!==r?r:"unknown sender",message:a.message}}),C({position:"bottom",title:"Message received",description:a.message,status:"success",duration:3e3,isClosable:!0}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.payload&&c.keys&&c.reverseAddressBook)){e.next=13;break}return e.prev=1,e.next=4,v.a.decryptWithPrivateKey(c.keys.privateKey,v.a.cipher.parse(t.payloadAsUtf8));case 4:n=e.sent,a=JSON.parse(n),r=v.a.recoverPublicKey(a.childSig,v.a.hash.keccak256(a.message)),k({type:"ADD_MESSAGE",payload:{from:null!==r&&void 0!==r?r:"unknown sender",message:a.message}}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(o.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{(n=JSON.parse(t.payloadAsUtf8)).chatKey&&O.a.utils.verifyMessage(v.a.publicKey.toAddress(n.chatKey),n.signature).toLowerCase()===n.address.toLowerCase()&&k({type:"ADD_PEER",payload:Object(r.a)({},n.address.toLowerCase(),n.chatKey)})}catch(a){console.log(a)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(o.a)(s.a.mark((function e(t,n){var a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.peerId,!n.protocols.includes(y.b)){e.next=24;break}return e.prev=2,e.next=5,t.store.queryHistory({peerId:a,contentTopics:[B],direction:x.Direction.FORWARD});case 5:if(!(r=e.sent)){e.next=9;break}return e.next=9,r.map((function(e){return T(e)}));case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log("".concat(a.toB58String(),": error encountered when retrieving archived messages"),e.t0);case 14:return e.prev=14,e.next=17,t.store.queryHistory({peerId:a,contentTopics:[E]});case 17:(c=e.sent)&&c.map((function(e){return W(e)})),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(14),console.log("".concat(a.toB58String(),": error encountered when retrieving archived messages"),e.t1);case 24:case"end":return e.stop()}}),e,null,[[2,11],[14,21]])})));return function(t,n){return e.apply(this,arguments)}}(),K=function(){var e=Object(o.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.c.create({config:{pubsub:{enabled:!0,emitSelf:!0}}});case 3:return t=e.sent,e.next=6,Object(y.e)(y.a.Prod);case 6:return n=e.sent,e.next=9,Promise.all(n.map((function(e){return t.dial(e)})));case 9:k({type:"START_WAKU",payload:{waku:t}}),t.relay.addObserver(D,[E]),t.relay.addObserver(T,[B]),t.libp2p.peerStore.on("change:protocols",_.bind({},t)),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.log("Issue starting waku ",e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),N=function(){var t=Object(o.a)(s.a.mark((function t(){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.getSigner().signMessage("make it so, Number One");case 2:return n=t.sent,t.next=5,v.a.createIdentity(e.from(n));case 5:r=t.sent,k({type:"SET_KEYS",payload:{keys:r}});case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),L=function(){var e=Object(o.a)(s.a.mark((function e(){var t,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.keys){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.getSigner().signMessage(c.keys.address);case 4:n=e.sent,r=y.d.fromUtf8String(JSON.stringify({address:c.address,chatKey:c.keys.publicKey,signature:n}),B),null===(t=c.waku)||void 0===t||t.relay.send(r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(o.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[{walletName:"metamask",preferred:!0},{walletName:"status",preferred:!0},{walletName:"trust",preferred:!0}],n=Object(h.a)({networkId:1,subscriptions:{wallet:function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{a=new O.a.providers.Web3Provider(t.provider),k({type:"SET_WEB3",payload:{web3:a}}),N()}catch(n){console.log(n)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),address:function(e){k({type:"SET_ADDRESS",payload:{address:e}})},balance:function(e){k({type:"SET_BALANCE",payload:{balance:e}})},network:function(e){k({type:"SET_CHAIN",payload:{chain:e}})}},walletSelect:{wallets:t},walletCheck:[{checkName:"connect"}]}),window.ethereum.enable(),e.prev=3,e.next=6,n.walletSelect();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),console.log(e.t0);case 11:k({type:"SET_ONBOARD",payload:{onboard:n}});case 12:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(){return e.apply(this,arguments)}}();return Object(A.jsx)(S.a.Provider,{value:{dispatch:k,state:c},children:Object(A.jsx)(d.a,{h:"95vh",mw:"95vw",children:Object(A.jsxs)(l.b,{children:[Object(A.jsx)(p.a,{children:"WakuMono"}),Object(A.jsxs)(b.a,{justify:"center",align:"center",direction:"row",children:[Object(A.jsx)(b.b,{children:Object(A.jsx)(g.a,{handleConnect:R})}),Object(A.jsx)(b.b,{children:Object(A.jsx)(f.a,{disabled:!c.keys,onClick:K,children:"Connect to Waku"})}),Object(A.jsx)(b.b,{children:Object(A.jsx)(f.a,{disabled:void 0!==c.addressBook[c.address],onClick:L,children:"Broadcast Chatkey"})})]}),Object(A.jsx)(j.a,{in:void 0!==c.waku,children:Object(A.jsx)(m.a,{})})]})})})}}).call(this,n(14).Buffer)},334:function(e,t){},578:function(e,t,n){"use strict";var a=n(25),r=n(1),c=n.n(r),s=n(28),o=n(19),i=n(149),u=n(200),d=n(591),l=n(1211),p=n(592),b=n(1212),f=n(393),j=n(289),h=n(1216),v=n(1213),O=n(148),y=n(0),x=n.n(y),k=n(587),w=n(389),m=n.n(w),g=n(265),S=n(147),A=n(228),E=n(22);t.a=function(){var e,t=x.a.useContext(S.a).state,n=x.a.useState([]),r=Object(o.a)(n,2),y=r[0],B=r[1],C=x.a.useState(""),D=Object(o.a)(C,2),W=D[0],T=D[1],_=x.a.useState(""),K=Object(o.a)(_,2),N=K[0],L=K[1];x.a.useEffect((function(){B(t.messageList)}),[t.messageList]);var R=function(){var e=Object(s.a)(c.a.mark((function e(n,a){var r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.web3&&t.keys){e.next=2;break}return e.abrupt("return");case 2:if(t.addressBook[n.toLowerCase()]){e.next=5;break}return console.log("no address found"),e.abrupt("return");case 5:return e.next=7,Object(A.a)(t.keys,t.addressBook[n.toLowerCase()],a);case 7:s=e.sent,o=O.d.fromUtf8String(s,g.a),null===(r=t.waku)||void 0===r||r.relay.send(o),T("");case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(E.jsxs)(i.b,{mw:"90vw",children:[Object(E.jsxs)(u.a,{sx:(e={position:"-webkit-sticky"},Object(a.a)(e,"position","sticky"),Object(a.a)(e,"top","5px"),e),minHeight:"100px",isInvalid:""!==N&&void 0===t.addressBook[N],children:[Object(E.jsxs)(i.a,{bg:"white",opacity:"1",children:[Object(E.jsx)(d.a,{maxWidth:"30vw",value:N,placeholder:"Address",onChange:function(e){return L(e.target.value)}}),Object(E.jsx)(d.a,{minWidth:"30vw",value:W,placeholder:"Enter a message",onChange:function(e){return T(e.target.value)}}),Object(E.jsx)(l.a,{disabled:void 0===t.addressBook[N.toLowerCase()],onClick:function(){R(N,W)},"aria-label":"send message",icon:Object(E.jsx)(k.a,{}),variant:"outline",colorScheme:"blackAlpha"})]}),Object(E.jsx)(p.a,{in:""!==N&&void 0===t.addressBook[N.toLowerCase()],children:Object(E.jsx)(b.a,{children:"Address not found"})})]}),Object(E.jsx)(f.a,{children:"Inbox"}),Object(E.jsxs)(i.a,{w:"75vw",spacing:"24px",children:[Object(E.jsx)(j.a,{fontWeight:"bold",w:"150px",children:"Sender"}),Object(E.jsx)(j.a,{fontWeight:"bold",children:"Message"})]}),Object(E.jsx)(i.b,{sx:{overflow:"scroll"},maxHeight:"100vh",children:y.map((function(e){return Object(E.jsxs)(i.a,{w:"75vw",spacing:"24px",children:[Object(E.jsxs)(i.a,{w:"150px",children:[e.from&&Object(E.jsx)(m.a,{diameter:20,seed:Object(w.jsNumberForAddress)(e.from)}),Object(E.jsx)(h.a,{hasArrow:!0,label:"Click to copy","aria-label":"copy",children:Object(E.jsx)(v.a,{cursor:"pointer",onClick:function(){return navigator.clipboard.writeText(t.reverseAddressBook[e.from])},children:Object(A.b)(t.reverseAddressBook[e.from])})})]}),Object(E.jsx)(j.a,{children:e.message})]},e.from+Math.random())}))})]})}},581:function(e,t,n){"use strict";var a=n(0),r=n.n(a),c=n(289),s=n(175),o=n(174),i=n(393),u=n(149),d=n(147),l=n(228),p=n(22);t.a=function(e){var t=e.handleConnect,n=r.a.useContext(d.a),a=n.state,b=n.dispatch;return Object(p.jsx)(c.a,{children:a.address?Object(p.jsxs)(s.a,{placement:"top",children:[Object(p.jsx)(s.g,{children:Object(p.jsx)(o.a,{minWidth:"200px",children:Object(l.b)(a.address)})}),Object(p.jsxs)(s.e,{children:[Object(p.jsx)(s.b,{}),Object(p.jsx)(s.d,{}),Object(p.jsx)(s.f,{children:Object(p.jsx)(i.a,{size:"sm",children:"Wallet Details"})}),Object(p.jsx)(s.c,{children:Object(p.jsx)(u.b,{children:Object(p.jsx)(o.a,{onClick:function(){a.onboard&&(a.onboard.walletReset(),b({type:"SET_ADDRESS",payload:{address:void 0}}),b({type:"SET_WEB3",payload:{web3:void 0}}))},children:"Disconnect Wallet"})})})]})]}):Object(p.jsx)(o.a,{w:"200px",onClick:t,children:"Connect Web3"})})}},616:function(e,t){},622:function(e,t){},628:function(e,t){},630:function(e,t){},641:function(e,t){},643:function(e,t){},655:function(e,t){},701:function(e,t){},703:function(e,t){},710:function(e,t){},711:function(e,t){},730:function(e,t){},985:function(e,t){}},[[1208,10,11]]]);
//# sourceMappingURL=main.05d99fd3.chunk.js.map